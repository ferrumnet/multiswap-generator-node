# index.ts

The `index.ts` file within the `src/services` directory of the `ferrumnet/multiswap-generator-node` repository serves as a central point for exporting modules. This file essentially organizes and makes accessible the defined modules in the project for periodic tasks.

# axios.service.ts

The file `axios.service.ts` contains three primary functions related to HTTP operations using the `axios` library, each designed to interact with the MultiSwap backend. Below are detailed descriptions of each function:

### 1\. getTransactions

This asynchronous function retrieves a list of pending swap transactions from the MultiSwap backend. It constructs a URL based on whether the environment is local or AWS, and appends query parameters specifying transaction status, node type, and the public key from the environment. The function includes authorization headers using a bearer token generated by `createAuthTokenForMultiswapBackend()`. If successful, it returns the transactions array from the response body. In case of failure, it logs the error and returns null.

### 2\. updateTransaction

This asynchronous function is used to update a transaction's status based on the transaction hash (`txHash`). It sends a PUT request to the MultiSwap backend with the transaction hash and additional body data. It similarly configures the base URL and headers as in `getTransactions`. The function returns the response from the backend.

### 3\. getRpcNodes

This asynchronous function fetches a list of RPC nodes from the MultiSwap backend. The function constructs a GET URL that includes the public key and specifies that the node type is a generator and pagination is disabled. It uses the same URL and header configuration as the other functions. The function returns the data array from the response body or null in the event of an error.

These functions are designed to ensure secure and authorized communication with the backend services, leveraging environment-based configurations to suit different deployment scenarios.

# cosmWasm.service.ts

Here's a detailed documentation for each function found in the cosmWasm.service.ts file of the GitHub repository:

### `getTransactionReceipt(txId: string, rpcURL: string, threshold: number = 0, tries: number = 0): Promise<TransactionReceipt>`

This asynchronous function retrieves a transaction receipt given a transaction ID and an RPC URL. It checks the transaction status and, if the number of attempts is less than the threshold, it recursively calls itself to retry fetching the transaction receipt. It returns a `TransactionReceipt` object which includes the transaction status.

### `signedTransaction(job: any, decodedData: any, transaction: any): Promise<any>`

This asynchronous function handles the process of creating a signed transaction. It calculates the destination amount, prepares transaction data including hash and signatures, and then calls `createSignedPayment` to sign the transaction data. The function catches and logs any errors during the process.

### `createSignedPayment(chainId: string, address: string, amount: string, token: string, salt: string, job: any): Promise<any>`

This function creates a payment signature based on blockchain transaction details. It constructs a withdrawal hash, retrieves a private key, and uses an Ethereum wallet to sign the hash. The function returns an object containing the signature and hash of the payment.

### `produceSignatureWithdrawHash(chainId: string, token: string, payee: string, amount: string, salt: string): any`

This function produces a hash for signature withdrawal based on several transaction parameters. It generates a JSON string that includes chain ID, payee, token, amount, and a salt, and returns an object containing the hash and an empty array of signatures.

### `getLogsFromTransactionReceipt(job: any)`

This function parses and processes logs from a transaction receipt to extract transaction-related data such as tokens, amounts, addresses, and status. It filters and retrieves values from the logs and constructs a decoded data object.

### `filterLogsAndGetValue(logs: any, key: string)`

This helper function filters logs to find and return a value associated with a specified key. It iterates through the events and attributes in the logs to match the key.

### `getDestinationAmount(data: any): Promise<any>`

This function returns the `swapBridgeAmount` from the provided data, typically used to determine the amount to be used in a blockchain transaction.

These functions together assist in managing and interacting with transactions on a blockchain via CosmWasm, particularly focusing on handling transaction receipts, signing transactions, and extracting relevant data from transaction logs.

# rpcNode.service.ts

This TypeScript file from the `multiswap-generator-node` repository provides services related to RPC (Remote Procedure Call) nodes. Below is a detailed breakdown of each function within the file:

#### 1\. `saveRpcNodes(data: [RpcNode])`

Purpose: This asynchronous function saves an array of `RpcNode` objects. Parameters:

- `data: [RpcNode]`: An array of `RpcNode` objects to be saved. Implementation:
- Calls `setRpcNodesData(data)` to save the RPC node data.

#### 2\. `getRpcNodeByChainId(chainId: string): RpcNode`

Purpose: Retrieves an RPC node based on the given chain ID. Parameters:

- `chainId: string`: The blockchain's chain ID for which the RPC node information is needed. Implementation:
- Retrieves all RPC nodes data using `getRpcNodesData()`.
- Searches through the data to find an RPC node matching the provided chain ID.
- Returns the found node if any; otherwise, returns a default object with the provided chain ID and an empty URL. Error Handling:
- Catches and logs any errors that occur during the search process.

Each function is designed to manage and retrieve information about RPC nodes, which are critical for blockchain interactions. This code is structured to ensure efficient data retrieval and handling, allowing for seamless integration within larger blockchain services.

# signature.service.ts

#### 1\. `getDataForSignature`

**Purpose**: Constructs and returns transaction data required for creating a signature.

**Parameters**:

- `job`: The job object containing details of the transaction.
- `decodedData`: Decoded data related to the transaction.
- `transaction`: The transaction object.

**Returns**: A promise that resolves to an object containing the transaction data.

#### 2\. `getValidWithdrawalData`

**Purpose**: Validates and returns withdrawal data if it matches the expected hash and is considered valid.

**Parameters**:

- `job`: The job object containing details of the transaction.
- `decodedData`: Decoded data related to the transaction.

**Returns**: A promise that resolves to an object containing the withdrawal data if valid, otherwise `null`.

#### 3\. `isValidSettledAmount`

**Purpose**: Validates the settled amount against the destination amount considering the slippage and distributed fee.

**Parameters**:

- `slippage`: Allowed slippage percentage.
- `sourceChainId`, `destinationChainId`: Chain IDs for source and destination.
- `destinationAmountIn`, `settledAmount`, `distributedFee`: Amounts involved in the transaction.

**Returns**: A promise that resolves to an object indicating whether the amount is valid and the adjusted `destinationAmountIn`.

#### 4\. `createSignedPayment`

**Purpose**: Creates and returns a signed payment hash and signature.

**Parameters**:

- Various parameters related to the transaction details, including `chainId`, `payee`, `amount`, `targetToken`, `contractAddress`, `salt`, `destinationAssetType`, etc.

**Returns**: An object containing the signature and hash.

#### 5\. `produceFoundaryHash`

**Purpose**: Produces a hash for a Foundary withdrawal transaction.

# web3.service.ts

#### 1\. `getTransactionReceipt`

**Description**: This function retrieves the transaction receipt for a given transaction ID and chain ID. It recursively tries to fetch the receipt until it succeeds or reaches the threshold of attempts.

**Parameters**:

- `txId: string`: The transaction ID.
- `chainId: string`: The chain ID.
- `threshold: number`: The maximum number of attempts.
- `tries: number`: The current attempt count (default is 0).

**Returns**: `Promise<TransactionReceipt>`

#### 2\. `getTransactionByHash`

**Description**: Retrieves a transaction by its hash.

**Parameters**:

- `txHash: string`: The transaction hash.
- `chainId: string`: The chain ID.

**Returns**: `Promise<Transaction>`

#### 3\. `signedTransaction`

**Description**: Signs a transaction with the provided job, decoded data, and transaction.

**Parameters**:

- `job: any`: Job data.
- `decodedData: any`: Decoded data from the transaction.
- `transaction: any`: Transaction data.

**Returns**: `Promise<any>`

#### 4\. `getCCTPLogsFromTransactionReceipt`

**Description**: Retrieves CCTP logs from a transaction receipt.

**Parameters**:

- `job: any`: Job data.

**Returns**: `any`

#### 5\. `getLogsFromTransactionReceipt`

**Description**: Retrieves logs from a transaction receipt.

**Parameters**:

- `job: any`: Job data.
- `isDistributedFee: boolean`: Flag indicating if the log is for a distributed fee.

**Returns**: `any`

#### 6\. `findSwapEvent`

**Description**: Finds the index of a swap event in the topics.

**Parameters**:

- `topics: any[]`: Array of topics.
- `job: any`: Job data.
- `isDistributedFee: boolean`: Flag indicating if the event is for a distributed fee.

**Returns**: `number | undefined`

#### 7\. `getFundManagerAddress`

**Description**: Retrieves the fund manager address for a given chain ID.

**Parameters**:

- `chainId: string`: The chain ID.
- `isCCTP: boolean`: Flag indicating if the address is for CCTP.

**Returns**: `string`
